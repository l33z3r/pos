//
//
// PAYMENT METHODS
//
//
//
var paymentMethods = {};

<% current_outlet.payment_methods.all.each do |pm|-%>
  payment_method_info = {
  id : '<%= pm.id %>',
  name : '<%= pm.name.downcase %>', 
  payment_integration_id : <%=pm.payment_integration_id%>, 
  receipt_footer_id : <%=pm.receipt_footer ? pm.receipt_footer_id : "null"%>, 
  open_cash_drawer : <%=pm.open_cash_drawer%>
  }

  paymentMethods[payment_method_info.id] = payment_method_info;

<% end -%>

//
//
// EXPENSES
//
//
//
var cashOutPresets = new Array();

<% current_outlet.cash_out_presets.all.each do |cop|-%>
  cash_out_preset_info = {
  id : '<%= cop.id %>',
  label : '<%= cop.label.downcase %>'
  }

  cashOutPresets.push(cash_out_preset_info);

<% end -%>

//
//
// PRINTERS
//
//
//
var printers = new Array();
var printerNetworkPaths = new Array();
var printersByID  = {};

<% current_outlet.printers.where("printer_type != ?", Printer::LOCAL).each do |printer|-%>

  printer_info = {
  id : '<%= printer.id %>',
  label : '<%= printer.label.downcase %>',
  local_printer : '<%= escape_javascript(printer.local_printer) %>',
  owner_fingerprint : '<%= printer.owner_fingerprint %>',
  network_share_name : '<%= escape_javascript(printer.network_share_name) %>',
  paper_width_mm: '<%= printer.paper_width_mm %>',
  font_size: '<%= printer.font_size %>',
  printer_type : <%= printer.printer_type %>, 
  in_use : <%= printer.in_use? ? "true" : "false" %>
  }

  printers.push(printer_info);
  printerNetworkPaths.push('<%= escape_javascript(printer.network_share_name) %>');
  printersByID[printer_info.id] = printer_info;

<% end -%>

<% 
if @terminal_fingerprint 
  #lazy init create local printer object
  @local_printer = current_outlet.printers.where("printer_type = ?", Printer::LOCAL).where("owner_fingerprint = ?", @terminal_fingerprint).first

  if !@local_printer
    @local_printer = Printer.new
    @local_printer.outlet_id = current_outlet.id
    @local_printer.printer_type = Printer::LOCAL
    @local_printer.local_printer = ""
    @local_printer.network_share_name = ""
    @local_printer.label = Printer.label_for_printer_type(Printer::LOCAL)
    @local_printer.owner_fingerprint = @terminal_fingerprint
    @local_printer.save!
  end
end  
%>

var localPrinter;

//if we have no TF yet, then just mock up a local printer object for now
<% if @local_printer %>
  localPrinter = {
  id : '<%= @local_printer.id %>',
  label : '<%= @local_printer.label.downcase %>',
  local_printer : '<%= escape_javascript(@local_printer.local_printer) %>',
  owner_fingerprint : '<%= @local_printer.owner_fingerprint %>',
  network_share_name : '<%= escape_javascript(@local_printer.network_share_name) %>',
  paper_width_mm: '<%= @local_printer.paper_width_mm %>',
  font_size: '<%= @local_printer.font_size %>',
  printer_type : <%= @local_printer.printer_type %>, 
  in_use : <%= @local_printer.in_use? ? "true" : "false" %>
  };
<% else %>
  localPrinter = {
  id : '-1',
  label : '',
  local_printer : '',
  owner_fingerprint : '',
  network_share_name : '',
  paper_width_mm: '80',
  font_size: '13',
  printer_type : <%= Printer::LOCAL %>, 
  in_use : false
  };
<% end %>

//
//
// TERMINALS
//
//
//  
var outletTerminals = new Array();
var assignedOutletTerminals = new Array();
var availableOutletTerminals = new Array();

<% current_outlet.outlet_terminals.all.each do |ot|-%>
  ot_info = {
  id : '<%= ot.id %>',
  name: '<%= ot.name %>',
  assigned: <%= ot.assigned %>,
  terminal_type: <%= ot.terminal_type %>
  }

  outletTerminals.push(ot_info);

  if(ot_info.assigned) {
  assignedOutletTerminals.push(ot_info);
  } else {
  availableOutletTerminals.push(ot_info);
  }

<% end -%>

//
//
// CUSTOMERS
//
//
//
var customers = new Array();

var creditCustomers = {};
var loyaltyCustomers = {};
var loyaltyCustomersByCode = {};

<% Customer.all_active(current_outlet).each do |c|-%>
  customer_info = {
  id : '<%= c.id %>',
  name : '<%= escape_javascript raw(c.name) %>',
  is_normal_customer : <%= c.is_normal_customer? ? "true" : "false" %>,
  is_loyalty_customer : <%= c.is_loyalty_customer? ? "true" : "false" %>,
  loyalty_level_id : <%= c.loyalty_level_id %>,
  available_points : <%= c.available_points %>,
  swipe_card_code : '<%= c.swipe_card_code %>',
  credit_limit : <%= c.credit_limit %>,
  current_balance : <%= c.current_balance %>,
  credit_available : <%= c.credit_available %>,
  customer_number : <%= c.customer_number.blank? ? -1 : c.customer_number %>,
  account_number : <%= c.account_number %>
  };

  customers.push(customer_info);

  if(customer_info.is_loyalty_customer) {
  loyaltyCustomers[customer_info.id] = customer_info;

  var loyaltyCardCodeStripped = customer_info.swipe_card_code;//.substring(0, 12);

  loyaltyCustomersByCode[loyaltyCardCodeStripped] = customer_info;
  }

  if(customer_info.is_normal_customer) {
  creditCustomers[customer_info.id] = customer_info;
  }
<% end -%>

//
//
// LOYALTY LEVELS
//
//
//
var loyaltyLevels = {};

<% current_outlet.loyalty_levels.all.each do |ll| -%>
  loyalty_level_info = {
  label : '<%= escape_javascript raw(ll.label) %>',
  percent : <%= ll.percent %>
  };

  loyaltyLevels[<%= ll.id %>] = loyalty_level_info;
<% end %>

//
//
// EMPLOYEES
//
//
//
var employees = new Array();

<% current_outlet.employees.all.each do |e|-%>
  employee_info = {
  id : '<%= e.id %>',
  nickname : '<%= escape_javascript raw(e.nickname) %>',
  passcode : '<%= e.passcode %>',
  clockin_code : '<%= e.clockin_code %>',
  dallas_code : '<%= e.dallas_code %>',
  is_admin : <%= e.is_admin current_outlet %>,
  role_id : <%= e.role.id %>,
  pin_required : <%= e.role.pin_required ? "true" : "false" %>,
  login_allowed : <%= e.role.login_allowed ? "true" : "false" %>,
  clocked_in : false
  }

  employees.push(employee_info);

  //make sure all users are clocked in
  if(typeof(initClockedInUsers) != "undefined") {
  initClockedInUsers();
  }

<% end -%>

//
//
// BUTTON PERMISSIONS
//
//
//
//build a map of button permissions
all_display_button_permissions = new Array();

<% current_outlet.roles.all.each do |role| %>
  all_display_button_permissions[<%=role.id%>] = new Array();

  <% DisplayButtonRole.menu_screen_buttons_for_role(current_outlet, role.id).each do |dbr| %>
    all_display_button_permissions[<%=role.id%>]['<%=dbr.display_button.perm_id%>'] = <%= dbr.passcode_required ? "true" : "false" %>;
  <% end %>

  <% DisplayButtonRole.admin_screen_buttons_for_role(current_outlet, role.id).each do |dbr| %>
    all_display_button_permissions[<%=role.id%>]['<%=dbr.display_button.perm_id%>'] = <%= dbr.passcode_required ? "true" : "false" %>;
  <% end %>
<% end %>

//
//
// PRODUCTS
//
//
//
var products = new Array();
var products_by_upc = new Array();
var non_deleted_products = new Array();
var stock_products = new Array();

<% current_outlet.products.all.each do |p|%>  

  var nextProduct = {
  'id':'<%= p.id %>', 'name':'<%= escape_javascript raw(p.name) %>', 
  'description':'<%= escape_javascript raw(p.description) %>', 
  'img_url' : '<%= escape_javascript raw(product_image_url(p)) %>',
  'price':<%= p.price %>, 'tax_rate':<%=p.get_sales_tax_rate(current_outlet)%>,
  'price_2':<%= p.price_2 %>, 'price_3':<%= p.price_3 %>, 'price_4':<%= p.price_4 %>,
  'double_price' : <%=p.double_price%>,
  'half_price' : <%=p.half_price%>,
  'cost_price' : <%=p.cost_price%>,
  'hide_on_printed_receipt' : <%=p.hide_on_printed_receipt%>,
  'show_price_on_receipt' : <%=p.show_price_on_receipt%>,
  'prompt_price' : <%=p.show_price_prompt%>,
  'is_stock_item' : <%=p.is_stock_item%>,
  'printers' : "<%= p.printers %>",
  'blocked_printers' : "<%= p.blocked_printers %>",
  'kitchen_screens' : "<%=p.kitchen_screens%>",
  'deleted' : <%= p.is_deleted %>,
  'category_id' : <%= p.category ? p.category.id : "null" %>,
  'upc' : '<%= p.upc %>',
  'code_num' : '<%= p.code_num %>',
  'modifier_grid_id' : <%= p.order_item_addition_grid ? p.order_item_addition_grid.id : "null" %>,
  'modifier_grid_id_mandatory' : <%= p.order_item_addition_grid_id_is_mandatory %>,
  'course_num' : <%= p.calc_course_num %>,
  'unit' : '<%= p.unit %>'
  };

  products[<%= p.id %>] = nextProduct;

  <% if !p.upc.blank? %>
    products_by_upc[<%= p.upc %>] = nextProduct;
  <% end %>

  <% if p.modifier_category_id %>
    products[<%= p.id %>]['modifier_category_id'] = <%=p.modifier_category_id%>;
  <% end %>

  if(!nextProduct.deleted) {
  non_deleted_products[<%= p.id %>] = nextProduct;

  if(nextProduct.is_stock_item) {
  stock_products[<%= p.id %>] = nextProduct;
  }
  }
<% end %>

//
//
// MODIFIERS
//
//
//
var modifier_categories = new Array();

<% current_outlet.modifier_categories.all.each do |mc| %>
  modifier_categories[<%=mc.id%>] = {'id':<%=mc.id%>, 'name':'<%= escape_javascript raw(mc.name) %>'}
  modifier_categories[<%=mc.id%>]['modifiers'] = new Array();
  <% mc.modifiers.all.each do |m| %>
    modifier_categories[<%=mc.id%>]['modifiers'][<%=m.id%>] = {'id':<%=m.id%>, 'name':'<%= escape_javascript m.name%>', 'price':<%=m.price%>}
  <% end %>
<% end %>

//
//
// CATEGORIES
//
//
//
var categories = new Array();

<% current_outlet.categories.all.each do |c|%>    
  categories[<%= c.id %>] = {
  'id':'<%= c.id %>', 'name':'<%= escape_javascript raw(c.name) %>', 
  'printers': "<%= c.printers %>",
  'blocked_printers' : "<%= c.blocked_printers %>",
  'kitchen_screens' : "<%=c.kitchen_screens%>",
  'modifier_grid_id' : <%= c.order_item_addition_grid ? c.order_item_addition_grid.id : "null" %>,
  'modifier_grid_id_mandatory' : <%= c.order_item_addition_grid_id_is_mandatory %>, 
  'parent_category_id' : <%= c.parent_category ? c.parent_category_id : "null" %>,
  'course_num' : <%= c.course_num %>,
  'prompt_for_covers' : <%= c.prompt_for_covers %>
  };
<% end %>

//
//
// TABLES
//
//
//
var tables = new Array();

//hard code table -2 for tempSplitBill
tables['-2'] = {
id : '0',
label : '0',
room_id : '0'
}

//hard code table -1 for previous Order
tables['-1'] = {
id : '0',
label : '0',
room_id : '0'
}

//hard code table 0
tables['0'] = {
id : '0',
label : '0',
room_id : '0'
}

<% current_outlet.table_infos.all.each do |ti|-%>
  table_info = {
  id : '<%= ti.id %>',
  label : '<%= ti.perm_id %>',
  room_id : '<%=ti.room_object.room_id%>'
  }

  tables['<%=ti.id%>'] = table_info;

<% end -%>

//
//
// ROOMS
//
//
//
var rooms = new Array();

//hard code room 0
rooms['0'] = {
id : '0',
defaultServiceChargePercent : '0', 
prompt_for_client_name : false
}

<% current_outlet.rooms.all.each do |room|-%>
  room_info = {
  id : '<%= room.id %>',
  defaultServiceChargePercent : '<%= room.default_service_charge_percent %>', 
  prompt_for_client_name : <%= room.prompt_for_client_name %>
  }

  rooms['<%=room.id%>'] = room_info;

<% end -%>

//build a big hash of global settings data
var globalSettingsMap = {};

globalSettingsMap['currentInterface'] = "<%= current_interface %>";

globalSettingsMap['bypassPin'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::BYPASS_PIN, current_outlet %>;

globalSettingsMap['bypassOpenOrdersForCashTotal'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::BYPASS_OPEN_ORDERS_FOR_CASH_TOTAL, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

var gsClockFormat = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CLOCK_FORMAT, current_outlet %>";
globalSettingsMap['clockFormat'] = gsClockFormat;

var gsDefaultJSDateFormat = "";
var gsDefaultJSTimeFormat = "";

if(gsClockFormat == "12") {
gsDefaultJSDateFormat = "hh:mm dd/MM/yyyy";
gsDefaultJSTimeFormat = "hh:mm";
} else {
gsDefaultJSDateFormat = "HH:mm dd/MM/yyyy";
gsDefaultJSTimeFormat = "HH:mm";
}

globalSettingsMap['defaultJSDateFormat'] = gsDefaultJSDateFormat;
globalSettingsMap['defaultJSTimeFormat'] = gsDefaultJSTimeFormat;

globalSettingsMap['showLicenceExpiredScreen'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::SHOW_LICENCE_EXPIRED_SCREEN, current_outlet %>;

globalSettingsMap['taxChargable'] = <%= @tax_chargable %>;

globalSettingsMap['taxLabel'] = "<%= @tax_label %>";

globalSettingsMap['globalTaxRate'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::GLOBAL_TAX_RATE, current_outlet %>;

globalSettingsMap['printVatReceipt'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::PRINT_VAT_RECEIPT, current_outlet %>;

globalSettingsMap['taxNumber'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::TAX_NUMBER, current_outlet %>";

globalSettingsMap['serviceChargeLabel'] = "<%= @service_charge_label %>";

globalSettingsMap['globalDefaultServiceChargePercent'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::DEFAULT_SERVICE_CHARGE_PERCENT, current_outlet %>;

globalSettingsMap['defaultPaymentMethod'] = "<%= PaymentMethod.load_default(current_outlet).name.downcase %>";

globalSettingsMap['cashPaymentMethodName'] = "<%= PaymentMethod::CASH_PAYMENT_METHOD_NAME %>";
globalSettingsMap['loyaltyPaymentMethodName'] = "<%= PaymentMethod::LOYALTY_PAYMENT_METHOD_NAME %>";
globalSettingsMap['accountPaymentMethodName'] = "<%= PaymentMethod::ACCOUNT_PAYMENT_METHOD_NAME %>";

globalSettingsMap['dynamicCurrencySymbol'] = "<%= @currency_symbol %>";

globalSettingsMap['defaultHomeScreen'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::DEFAULT_HOME_SCREEN, current_outlet, {:fingerprint => @terminal_fingerprint} %>;
globalSettingsMap['defaultPostLoginScreen'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::DEFAULT_POST_LOGIN_SCREEN, current_outlet %>;
globalSettingsMap['LOGIN_SCREEN'] = <%= GlobalSetting::LOGIN_SCREEN %>;
globalSettingsMap['MENU_SCREEN'] = <%= GlobalSetting::MENU_SCREEN %>;
globalSettingsMap['TABLES_SCREEN'] = <%= GlobalSetting::TABLES_SCREEN %>;

globalSettingsMap['menuScreenType'] = <%= @menu_screen_type %>;
globalSettingsMap['RESTAURANT_MENU_SCREEN'] = <%= GlobalSetting::RESTAURANT_MENU_SCREEN %>;
globalSettingsMap['RETAIL_MENU_SCREEN'] = <%= GlobalSetting::RETAIL_MENU_SCREEN %>;
globalSettingsMap['CUSTOMER_MENU_SCREEN'] = <%= GlobalSetting::CUSTOMER_MENU_SCREEN %>;

globalSettingsMap['lastOrderReadyNotificationTime'] = <%= now_local_millis %>;

globalSettingsMap['autoPrintReceipt'] = <%= @auto_print_receipt %>;

globalSettingsMap['receiptMessage'] = "<%= raw escape_javascript((GlobalSetting.parsed_setting_for(GlobalSetting::RECEIPT_MESSAGE, current_outlet))) %>";

var gsCustomReceiptFooters = {};

<% current_outlet.receipt_footers.all.each do |rf| %>
  gsCustomReceiptFooters[<%=rf.id%>] = {"name" : "<%=rf.name%>", "content" : "<%= raw escape_javascript(rf.content) %>"};
<% end %>

globalSettingsMap['customReceiptFooters'] = gsCustomReceiptFooters;

globalSettingsMap['businessInfoMessage'] = "<%= raw escape_javascript((GlobalSetting.parsed_setting_for(GlobalSetting::BUSINESS_INFO_MESSAGE, current_outlet))) %>";

globalSettingsMap['defaultDiscountPercent'] = "<%= Discount.load_default(current_outlet).percent %>";

globalSettingsMap['terminalID'] = "<%=@terminal_id%>";

globalSettingsMap['TERMINAL_TYPE_NORMAL'] = <%= OutletTerminal::TERMINAL_TYPE_NORMAL %>;
globalSettingsMap['TERMINAL_TYPE_MOBILE'] = <%= OutletTerminal::TERMINAL_TYPE_MOBILE %>;
globalSettingsMap['TERMINAL_TYPE_KITCHEN'] = <%= OutletTerminal::TERMINAL_TYPE_KITCHEN %>;

globalSettingsMap['pollingAmount'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::POLLING_INTERVAL_SECONDS, current_outlet %> * 1000;
globalSettingsMap['pollingMinSeconds'] = <%= GlobalSetting::POLLING_MIN_SECONDS %>;
globalSettingsMap['pollingMaxSeconds'] = <%= GlobalSetting::POLLING_MAX_SECONDS %>;

globalSettingsMap['using_mobile'] = <%= mobile_device? ? "true" : "false" %>;

globalSettingsMap['doBeep'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::DO_BEEP, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

globalSettingsMap['railsEnvironment'] = "<%= ENV['RAILS_ENV'] %>";

globalSettingsMap['kioskMode'] = <%= CUSTOM_CONFIG["in_kiosk_mode"] %>;
globalSettingsMap['overrideKiosk'] = <%= params["override_kiosk"] or params["ok"] ? true : false %>;

globalSettingsMap['business_name'] = "<%= @business_name %>";
globalSettingsMap['business_address'] = "<%= @business_address %>";
globalSettingsMap['business_telephone'] = "<%= @business_telephone %>";
globalSettingsMap['business_fax'] = "<%= @business_fax %>";
globalSettingsMap['business_email_address'] = "<%= @business_email_address %>";

<% @display = Display.load_default(current_outlet) unless @display %>

globalSettingsMap['selectedDisplayId'] = <%= @display.id %>;

globalSettingsMap['modifyOrderItemButtonID'] = "<%= ButtonMapper::MODIFY_ORDER_ITEM_BUTTON %>";
globalSettingsMap['addNoteButtonID'] = "<%= ButtonMapper::ADD_NOTE_BUTTON %>";
globalSettingsMap['tablesButtonID'] = "<%= ButtonMapper::TABLES_BUTTON %>";
globalSettingsMap['discountButtonID'] = "<%= ButtonMapper::DISCOUNT_BUTTON %>";
globalSettingsMap['changePriceButtonID'] = "<%= ButtonMapper::CHANGE_PRICE_BUTTON %>";
globalSettingsMap['removeItemButtonID'] = "<%= ButtonMapper::REMOVE_ITEM_BUTTON %>";
globalSettingsMap['toggleMenuItemDoubleModeButtonID'] = "<%= ButtonMapper::TOGGLE_MENU_ITEM_DOUBLE_BUTTON %>";
globalSettingsMap['toggleMenuItemHalfModeButtonID'] = "<%= ButtonMapper::TOGGLE_MENU_ITEM_HALF_BUTTON %>";
globalSettingsMap['toggleMenuItemStandardPriceOverrideModeButtonID'] = "<%= ButtonMapper::TOGGLE_MENU_ITEM_STANDARD_PRICE_OVERRIDE_BUTTON %>";
globalSettingsMap['oiaButtonID'] = "<%= ButtonMapper::MODIFY_ORDER_ITEM_BUTTON %>";
globalSettingsMap['courseNumButtonID'] = "<%= ButtonMapper::COURSE_BUTTON %>";
globalSettingsMap['voidOrderItemButtonID'] = "<%= ButtonMapper::VOID_ORDER_ITEM_BUTTON %>";
globalSettingsMap['priceChangeButtonID'] = "<%= ButtonMapper::CHANGE_PRICES_BUTTON %>";
globalSettingsMap['toggleProductInfoButtonID'] = "<%= ButtonMapper::PRODUCT_INFO_POPUP_BUTTON %>";
globalSettingsMap['toggleTrainingModeButtonID'] = "<%= ButtonMapper::TRAINING_MODE_TOGGLE_BUTTON %>";
globalSettingsMap['deliveryButtonID'] = "<%= ButtonMapper::DELIVERY_BUTTON %>";
globalSettingsMap['changeCostPriceButtonID'] = "<%= ButtonMapper::CHANGE_COST_PRICE_BUTTON %>";
globalSettingsMap['editLoyaltyPointsButtonID'] = "<%= ButtonMapper::EDIT_LOYALTY_POINTS_BUTTON %>";
globalSettingsMap['cashOutButtonID'] = "<%= ButtonMapper::CASH_OUT_BUTTON %>";

globalSettingsMap['updateStockType'] = <%= StockTransaction::STOCK_UPDATE %>;
globalSettingsMap['transferStockType'] = <%= StockTransaction::STOCK_TRANSFER %>;

globalSettingsMap['creditCardChargeServiceIP'] = "<%= @credit_card_charge_service_ip %>";
globalSettingsMap['creditCardTerminalIP'] = "<%= @credit_card_terminal_ip %>";
globalSettingsMap['creditCardTerminalPort'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CREDIT_CARD_TERMINAL_PORT, current_outlet, {:fingerprint => @terminal_fingerprint} %>";

globalSettingsMap['allDevicesOrderNotification'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::All_DEVICES_ORDER_NOTIFICATION, current_outlet %>;

//these variables are used to get a syncronised time on each device
globalSettingsMap['serverCounterStartTimeMillis'] = <%= now_local_millis %>;
globalSettingsMap['counterStartTimeMillis'] = new Date().getTime();

//payment integration IDs
globalSettingsMap['zalionPaymentIntegrationId'] = <%= PaymentMethod::PAYMENT_INTEGRATION_ZALION %>;

globalSettingsMap['zalionChargeRoomServiceIP'] = "<%= @zalion_charge_room_service_ip %>";

globalSettingsMap['disableAdvancedTouch'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::DISABLE_ADVANCED_TOUCH, current_outlet, {:fingerprint => @terminal_fingerprint, :user_agent => request.user_agent} %>;

//enumerate the course labels
var gsCourseLabels = {};

<% GlobalSetting.course_options(current_outlet).each do |label, course_val| %>
  gsCourseLabels[<%=course_val%>] = "<%=label%>";
<% end %>

globalSettingsMap['courseLabels'] = gsCourseLabels;

globalSettingsMap['isProcessingTable0Orders'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::PROCESS_TABLE_0_ORDERS, current_outlet %>;

globalSettingsMap['loyaltyCardPrefix'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::LOYALTY_CARD_PREFIX, current_outlet %>";
globalSettingsMap['enableLoyaltyCardRedemption'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::ENABLE_LOYALTY_REDEMPTION, current_outlet %>;
globalSettingsMap['loyaltyPointsPerCurrencyUnit'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::LOYALTY_POINTS_PER_CURRENCY_UNIT, current_outlet %>;

globalSettingsMap['halfMeasureLabel'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::HALF_MEASURE_LABEL, current_outlet %>";

globalSettingsMap['allowedZalionSplitPayments'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::ALLOW_ZALION_SPLIT_PAYMENTS, current_outlet %>;

globalSettingsMap['currentResolution'] = "<%= @currentResolution %>";
globalSettingsMap['normalResolution'] = "<%= @normalResolution %>";
globalSettingsMap['resolution1360x786'] = "<%= @resolution1360x786 %>";

globalSettingsMap['triggerCashDrawerViaPrinter'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::TRIGGER_CASH_DRAWER_VIA_PRINTER, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

globalSettingsMap['cashDrawerViaPrinterMappedPort'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CASH_DRAWER_VIA_PRINTER_MAPPED_PORT, current_outlet, {:fingerprint => @terminal_fingerprint} %>";
globalSettingsMap['cashDrawerLocalPrinterShareName'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CASH_DRAWER_LOCAL_PRINTER_SHARE_NAME, current_outlet, {:fingerprint => @terminal_fingerprint} %>";

globalSettingsMap['cashDrawerComPort'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CASH_DRAWER_COM_PORT, current_outlet, {:fingerprint => @terminal_fingerprint} %>";
globalSettingsMap['cashDrawerCode'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::CASH_DRAWER_CODE, current_outlet, {:fingerprint => @terminal_fingerprint} %>";

var gsPmShortcut1ID = <%= GlobalSetting.parsed_setting_for GlobalSetting::PM_SHORTCUT_ID, current_outlet, {:shortcut_num => 1} %>;
var gsPmShortcut2ID = <%= GlobalSetting.parsed_setting_for GlobalSetting::PM_SHORTCUT_ID, current_outlet, {:shortcut_num => 2} %>;
var gsPmShortcut3ID = <%= GlobalSetting.parsed_setting_for GlobalSetting::PM_SHORTCUT_ID, current_outlet, {:shortcut_num => 3} %>;

globalSettingsMap['pmShortcut1ID'] = gsPmShortcut1ID;
globalSettingsMap['pmShortcut2ID'] = gsPmShortcut2ID;
globalSettingsMap['pmShortcut3ID'] = gsPmShortcut3ID;

var gsPmShortcutMap = {};

gsPmShortcutMap[1] = gsPmShortcut1ID;
gsPmShortcutMap[2] = gsPmShortcut2ID;
gsPmShortcutMap[3] = gsPmShortcut3ID;

globalSettingsMap['pmShortcutMap'] = gsPmShortcutMap;

globalSettingsMap['globalAutoPromptForCovers'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::PROMPT_FOR_COVERS, current_outlet %>;

globalSettingsMap['clueyUserId'] = <%= Employee.cluey_user(current_outlet).id %>;
globalSettingsMap['chefUserId'] = <%= Employee.chef_user(current_outlet).id %>;

globalSettingsMap['printLocalDeliveryReceipts'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::PRINT_LOCAL_RECIEVE_DELIVERY, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

globalSettingsMap['printDelegateTerminalID'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::PRINT_DELEGATE_TERMINAL_ID, current_outlet %>";
globalSettingsMap['offlineOrderDelegateTerminal'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::OFFLINE_ORDER_DELEGATE_TERMINAL_ID, current_outlet %>";

globalSettingsMap['accountsURL'] = "<%= @accounts_url %>";
globalSettingsMap['outletTerminalsURL'] = "<%= @outlet_terminals_url %>";

globalSettingsMap['terminal_fingerprint'] = "<%= @terminal_fingerprint %>";

globalSettingsMap['enablePollingForKitchenScreen'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::ENABLE_POLLING_FOR_KITCHEN_SCREEN, current_outlet %>;

globalSettingsMap['SYSTEM_WIDE_UPDATE_TYPE_NONE'] = <%= GlobalSetting::SYSTEM_WIDE_UPDATE_NONE %>;
globalSettingsMap['SYSTEM_WIDE_UPDATE_TYPE_SOFT'] = <%= GlobalSetting::SYSTEM_WIDE_UPDATE_SOFT %>;
globalSettingsMap['SYSTEM_WIDE_UPDATE_TYPE_HARD'] = <%= GlobalSetting::SYSTEM_WIDE_UPDATE_HARD %>;

globalSettingsMap['systemWideUpdatePromptRequired'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::SYSTEM_WIDE_UPDATE_PROMPT_REQUIRED, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

globalSettingsMap['comPortModeString'] = "<%= GlobalSetting.parsed_setting_for GlobalSetting::COM_PORT_MODE_STRING, current_outlet, {:fingerprint => @terminal_fingerprint} %>";

globalSettingsMap['printSummaryReceipt'] = <%= GlobalSetting.parsed_setting_for GlobalSetting::PRINT_SUMMARY_RECEIPT, current_outlet, {:fingerprint => @terminal_fingerprint} %>;

globalSettingsMap['PRINTER_TYPE_LOCAL'] = <%= Printer::LOCAL %>;
globalSettingsMap['PRINTER_TYPE_KITCHEN_1'] = <%= Printer::KITCHEN_1 %>;
globalSettingsMap['PRINTER_TYPE_BAR_1'] = <%= Printer::BAR_1 %>;
globalSettingsMap['PRINTER_TYPE_KITCHEN_2'] = <%= Printer::KITCHEN_2 %>;
globalSettingsMap['PRINTER_TYPE_BAR_2'] = <%= Printer::BAR_2 %>;
globalSettingsMap['PRINTER_TYPE_OTHER'] = <%= Printer::OTHER %>;

globalSettingsMap['currentOutletId'] = <%= current_outlet.id %>;