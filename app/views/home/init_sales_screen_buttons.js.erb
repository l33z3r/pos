<% cache("employee_display_buttons_#{@current_employee_id}") do %>

  <% 
  @menu_screen_dbrs = DisplayButtonRole.find(:all, :include => "display_button",
    :conditions => "role_id = #{@employee.role.id} and (show_on_sales_screen is true 
    and (show_on_admin_screen is true or role_id = #{Role::SUPER_USER_ROLE_ID}) 
    or (display_buttons.perm_id = #{ButtonMapper::MORE_OPTIONS_BUTTON} and role_id = #{Role::SUPER_USER_ROLE_ID}))")

  @more_options_screen_dbrs = DisplayButtonRole.admin_screen_buttons_for_role(@employee.role.id)

%>

  //FIRST DO THE BUTTONS THAT APPEAR ON THE MAIN MENU SCREEN

  //replace the screen buttons div
  $('#menu_buttons_loading_message').hide();
  
  //show the button panel
  $('#menu_buttons_panel').show();
  
  $('#menu_buttons_panel').html("<%= escape_javascript(render :partial => 'screen_buttons', :locals => {:dbrs => @menu_screen_dbrs}) %>");

  //stash the button permissions into an array
  display_button_passcode_permissions = new Array();

  <% @menu_screen_dbrs.each do |dbr| %>
    display_button_passcode_permissions['<%=dbr.display_button.id%>'] = <%= dbr.passcode_required ? "true" : "false" %>
  <% end %>


  //NOW DO THE BUTTONS THAT APPEAR ON THE MORE OPTIONS SCREEN

  //stash the button permissions into an array
  <% @more_options_screen_dbrs.each do |dbr| %>
    display_button_passcode_permissions['<%=dbr.display_button.id%>'] = <%= dbr.passcode_required ? "true" : "false" %>
  <% end %>

  //replace the screen buttons div
  $('#options_screen_menu_buttons').html("<%= escape_javascript(render :partial => 'more_options_screen_buttons', :locals => {:dbrs => @more_options_screen_dbrs}) %>");
<% end %>