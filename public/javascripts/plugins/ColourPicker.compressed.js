/*

ColourPicker.js

A colour picker widget.

http://www.safalra.com/web-design/javascript/widgets/colour-picker/

The author of this program, Safalra (Stephen Morley), irrevocably releases all
rights to this program, with the intention of it becoming part of the public
domain. Because this program is released into the public domain, it comes with
no warranty either expressed or implied, to the extent permitted by law.

For more free and public domain JavaScript code by the same author, visit:
http://www.safalra.com/web-design/javascript/

*/

function ColourPicker(_1,_2,_3){var _4=(_3?_3:new RGBColour(0,0,0));var _5=[];var _6=false;var _7=null;var _8=null;var _9=null;var _a=null;var _b=null;var _c=null;var _d=null;var _e=0;var _f=0;var _10=null;var _11=[];var _12=document.createElement("div");_12.style.position="relative";_12.style.width="500px";_12.style.height="256px";var _13=document.createElement("div");_12.appendChild(_13);_13.style.position="absolute";_13.style.top="0px";_13.style.width="256px";_13.style.height="256px";var _14=document.createElement("div");_13.appendChild(_14);if(window.XMLHttpRequest){_14.style.background="url(\""+_2+"white-fade.png\") repeat-y top left";}else{_14.style.width="200px";_14.style.height="200px";_14.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+_2+"white-fade.png\",sizingMethod=\"scale\")";}var _15=document.createElement("div");_14.appendChild(_15);if(window.XMLHttpRequest){_15.style.background="url(\""+_2+"black-fade.png\") repeat-x top left";}else{_15.style.width="200px";_15.style.height="200px";_15.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+_2+"black-fade.png\",sizingMethod=\"scale\")";}var _16=document.createElement("div");_15.appendChild(_16);if(window.XMLHttpRequest){_16.style.backgroundImage="url(\""+_2+"circle.png\")";}else{_16.style.backgroundImage="url(\""+_2+"square.png\")";}_16.style.backgroundRepeat="no-repeat";_16.style.width="256px";_16.style.height="256px";_16.style.cursor="crosshair";var _17=document.createElement("div");_12.appendChild(_17);_17.style.background="url(\""+_2+"hue-bar.png\") repeat-x top left";_17.style.position="absolute";_17.style.left="272px";_17.style.top="0px";_17.style.width="16px";_17.style.height="256px";var _18=document.createElement("div");_12.appendChild(_18);_18.style.backgroundImage="url(\""+_2+"pointers.png\")";_18.style.backgroundRepeat="no-repeat";_18.style.position="absolute";_18.style.left="260px";_18.style.top="-7px";_18.style.width="40px";_18.style.height="270px";_18.style.cursor="crosshair";var _19=document.createElement("div");_12.appendChild(_19);_19.style.position="absolute";_19.style.left="304px";_19.style.top="0px";_19.style.width="100px";_19.style.height="100px";createComponentcomponentInputBoxes(["R","G","B"],["","",""],314,116,updateFromRGB);createComponentcomponentInputBoxes(["H","S","V"],["\xb0","%","%"],420,0,updateFromHSV);createComponentcomponentInputBoxes(["H","S","L"],["\xb0","%","%"],420,116,updateFromHSL);var _1a=document.createElement("div");_1a.appendChild(document.createTextNode("Hexadecimal:"));_12.appendChild(_1a);_1a.style.position="absolute";_1a.style.left="304px";_1a.style.top="232px";_1a.style.width="100px";_1a.style.textAlign="center";_1a.style.fontSize="14px";_1a.style.lineHeight="21px";var _1b=document.createElement("input");_12.appendChild(_1b);_1b.style.position="absolute";_1b.style.left="420px";_1b.style.top="232px";_1b.style.width="78px";_1b.style.textAlign="center";_1b.style.fontFamily="monospace";if(_1b.addEventListener){_1b.addEventListener("keyup",updateFromHexadecimal,false);}else{if(_1b.attachEvent){_1b.attachEvent("onkeyup",updateFromHexadecimal);}}updateColour();_1.appendChild(_12);if(window.addEventListener){window.addEventListener("mouseup",mouseUpListener,false);_16.addEventListener("mousedown",circleStartDrag,false);_18.addEventListener("mousedown",pointersStartDrag,false);}else{if(document.attachEvent){document.body.attachEvent("onmouseup",mouseUpListener);_16.attachEvent("onmousedown",circleStartDrag);_18.attachEvent("onmousedown",pointersStartDrag);}}function createComponentcomponentInputBoxes(_1c,_1d,_1e,top,_20){var _21=_1c.join("");_5[_21]=[];var _22=document.createElement("div");_22.appendChild(document.createTextNode(_21));_12.appendChild(_22);_22.style.position="absolute";_22.style.left=_1e+"px";_22.style.top=top+"px";_22.style.width="80px";_22.style.textAlign="center";_22.style.fontSize="14px";_22.style.lineHeight="21px";for(var i=0;i<3;i++){var _24=document.createElement("div");_24.appendChild(document.createTextNode(_1c[i]+":"));_12.appendChild(_24);_24.style.position="absolute";_24.style.left=_1e+"px";_24.style.top=(top+25*i+25)+"px";_24.style.width="20px";_24.style.fontSize="14px";_24.style.lineHeight="21px";var _25=document.createElement("input");_12.appendChild(_25);_25.style.position="absolute";_25.style.left=(_1e+20)+"px";_25.style.top=(top+25*i+25)+"px";_25.style.width="38px";_25.style.textAlign="right";if(_25.addEventListener){_25.addEventListener("keyup",_20,false);}else{if(_25.attachEvent){_25.attachEvent("onkeyup",_20);}}_5[_21][_1c[i]]=_25;var _26=document.createElement("div");_26.appendChild(document.createTextNode(_1d[i]));_12.appendChild(_26);_26.style.position="absolute";_26.style.left=(_1e+65)+"px";_26.style.top=(top+25*i+25)+"px";_26.style.width="15px";_26.style.fontSize="14px";_26.style.lineHeight="21px";}}function updateFromRGB(){_4=new RGBColour(parseInt("0"+_5.RGB.R.value,10),parseInt("0"+_5.RGB.G.value,10),parseInt("0"+_5.RGB.B.value,10));updateColour();}function updateFromHSV(){_4=new HSVColour(parseInt("0"+_5.HSV.H.value,10),parseInt("0"+_5.HSV.S.value,10),parseInt("0"+_5.HSV.V.value,10));updateColour();}function updateFromHSL(){_4=new HSLColour(parseInt("0"+_5.HSL.H.value,10),parseInt("0"+_5.HSL.S.value,10),parseInt("0"+_5.HSL.L.value,10));updateColour();}function updateFromHexadecimal(){var _27=_1b.value;if(_27.match(/^#[0-9a-f]{6}$/i)){_4=new RGBColour(parseInt(_27.substring(1,3),16),parseInt(_27.substring(3,5),16),parseInt(_27.substring(5,7),16));updateColour();}}function updateColour(){_19.style.background=_4.getCSSIntegerRGB();var rgb=_4.getIntegerRGB();var hsv=_4.getHSV();var hsl=_4.getHSL();_13.style.backgroundColor=(new HSVColour(hsv.h,100,100)).getCSSIntegerRGB();_16.style.backgroundPosition=Math.round(hsv.s/100*255-7)+"px "+Math.round((100-hsv.v)/100*255-7)+"px";_18.style.backgroundPosition="0px "+Math.floor(hsv.h/360*256)+"px";_5.RGB.R.value=rgb.r;_5.RGB.G.value=rgb.g;_5.RGB.B.value=rgb.b;_5.HSV.H.value=Math.floor(hsv.h);_5.HSV.S.value=Math.round(hsv.s);_5.HSV.V.value=Math.round(hsv.v);_5.HSL.H.value=Math.floor(hsl.h);_5.HSL.S.value=Math.round(hsl.s);_5.HSL.L.value=Math.round(hsl.l);_1b.value=_4.getCSSHexadecimalRGB();for(var i=0;i<_11.length;i++){_11[i](_4,this);}}function mouseUpListener(e){if(!e){e=window.event;}_6=false;}function mouseMoveListener(e){if(!e){e=window.event;}_7=e.screenX;_8=e.screenY;if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}function circleStartDrag(e){_9=true;startDrag(e);}function pointersStartDrag(e){_9=false;startDrag(e);}function startDrag(e){if(!_10){_6=true;if(!e){e=window.event;}mouseMoveListener(e);if(document.body.addEventListener){document.body.addEventListener("mousemove",mouseMoveListener,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",mouseMoveListener);}}_a=_7;_b=_8;_c=null;_d=null;if(e.offsetX){_e=e.offsetX;_f=e.offsetY;}else{if(e.layerX){_e=e.layerX;_f=e.layerY;}}_10=window.setInterval(updateDrag,20);}}function updateDrag(){var hsv=_4.getHSV();if(_9){_4=new HSVColour(hsv.h,(_7-_a+_e)/2.55,100-(_8-_b+_f)/2.55);}else{_4=new HSVColour(Math.max(0,Math.min(359,(_8-_b+_f-7)/255*360)),hsv.s,hsv.v);}if(_c!=_7||_d!=_8){updateColour();}_c=_7;_d=_8;if(!_6){if(document.body.removeEventListener){document.body.removeEventListener("mousemove",mouseMoveListener,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",mouseMoveListener);}}window.clearInterval(_10);_10=null;}}this.getColour=function(){return _4;};this.setColour=function(_32){_4=_32;updateColour();};this.addChangeListener=function(_33){this.removeChangeListener(_33);_11.push(_33);};this.removeChangeListener=function(_34){for(var i=_11.length-1;i>=0;i--){if(_11[i]==_34){_11.splice(i,1);}}};}
